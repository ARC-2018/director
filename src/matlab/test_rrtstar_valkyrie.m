

disp(exist('ikServerStarted'))

%-------- startup --------

format long e
addpath_control
addpath([getenv('DRC_BASE'), '/software/ddapp/src/matlab'])
robotURDF = [getenv('DRC_BASE'), '/software/models/val_description/urdf/valkyrie_A_sim_drake.urdf'];
fixed_point_file = [getenv('DRC_BASE'), '/software/control/matlab/data/val_description/valkyrie_fp_june2015.mat'];
left_foot_link = 'LeftFoot';
right_foot_link = 'RightFoot';
runIKServer

%------ startup end ------

disp(exist('ikServerStarted'))
dp.options.quat_tol = 0.0;
dp.options.tol = 0.0;
dp.options.seed_with_current = 0;

% ------ driving planner startup ------

addpath([getenv('DRC_BASE'), '/software/control/matlab/planners/driving_planner']);
clear driving_planner_options;
driving_planner_options.listen_to_lcm_flag = 0;
driving_planner_options.qstar = q_nom;
dp = drivingPlanner(s.robot, driving_planner_options);

% ------ driving planner startup end ------

environment_urdf_string = ['<?xml version="1.0"?>'...
'<robot name="affordance_environment">'...
'  <link name="link_74eb9cea-4f41-11e5-8085-54ee75451821">'...
'    <visual>'...
'      <origin xyz="1.25 0.1 0.98" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.07 0.07 0.25"/>'...
'      </geometry>'...
'      <material name="material_74eb9cea-4f41-11e5-8085-54ee75451821">'...
'        <color rgba="0.0 0.9 0.0 1"/>'...
'      </material>'...
'    </visual>'...
'    <collision>'...
'      <origin xyz="1.25 0.1 0.98" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.07 0.07 0.25"/>'...
'      </geometry>'...
'    </collision>'...
'  </link>'...
'  <link name="link_74ecb2f6-4f41-11e5-8085-54ee75451821">'...
'    <visual>'...
'      <origin xyz="1.25 -0.1 0.95" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <cylinder radius="0.035" length="0.22"/>'...
'      </geometry>'...
'      <material name="material_74ecb2f6-4f41-11e5-8085-54ee75451821">'...
'        <color rgba="0.0 0.9 0.0 1"/>'...
'      </material>'...
'    </visual>'...
'    <collision>'...
'      <origin xyz="1.25 -0.1 0.95" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <cylinder radius="0.035" length="0.22"/>'...
'      </geometry>'...
'    </collision>'...
'  </link>'...
'  <link name="link_74edf260-4f41-11e5-8085-54ee75451821">'...
'    <visual>'...
'      <origin xyz="1.05 -0.2 0.95" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <cylinder radius="0.045" length="0.22"/>'...
'      </geometry>'...
'      <material name="material_74edf260-4f41-11e5-8085-54ee75451821">'...
'        <color rgba="0.9 0.1 0.1 1"/>'...
'      </material>'...
'    </visual>'...
'    <collision>'...
'      <origin xyz="1.05 -0.2 0.95" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <cylinder radius="0.045" length="0.22"/>'...
'      </geometry>'...
'    </collision>'...
'  </link>'...
'  <link name="link_74e6792c-4f41-11e5-8085-54ee75451821">'...
'    <visual>'...
'      <origin xyz="1.2 0.0 0.8" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.5 1 0.06"/>'...
'      </geometry>'...
'      <material name="material_74e6792c-4f41-11e5-8085-54ee75451821">'...
'        <color rgba="0.66 0.66 0.66 1"/>'...
'      </material>'...
'    </visual>'...
'    <collision>'...
'      <origin xyz="1.2 0.0 0.8" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.5 1 0.06"/>'...
'      </geometry>'...
'    </collision>'...
'  </link>'...
'  <link name="link_74f0b5e0-4f41-11e5-8085-54ee75451821">'...
'    <visual>'...
'      <origin xyz="0.62 -1.33 0.8" rpy="0.0 0.0 -0.530773497203"/>'...
'      <geometry>'...
'        <box size="0.02 0.02 0.02"/>'...
'      </geometry>'...
'      <material name="material_74f0b5e0-4f41-11e5-8085-54ee75451821">'...
'        <color rgba="1 0 0 1"/>'...
'      </material>'...
'    </visual>'...
'    <collision>'...
'      <origin xyz="0.62 -1.33 0.8" rpy="0.0 0.0 -0.530773497203"/>'...
'      <geometry>'...
'        <box size="0.02 0.02 0.02"/>'...
'      </geometry>'...
'    </collision>'...
'  </link>'...
'  <link name="link_74e97262-4f41-11e5-8085-54ee75451821">'...
'    <visual>'...
'      <origin xyz="1.2 -0.5 0.4" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.5 0.05 0.8"/>'...
'      </geometry>'...
'      <material name="material_74e97262-4f41-11e5-8085-54ee75451821">'...
'        <color rgba="0.66 0.66 0.66 1"/>'...
'      </material>'...
'    </visual>'...
'    <collision>'...
'      <origin xyz="1.2 -0.5 0.4" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.5 0.05 0.8"/>'...
'      </geometry>'...
'    </collision>'...
'  </link>'...
'  <link name="link_74ea872e-4f41-11e5-8085-54ee75451821">'...
'    <visual>'...
'      <origin xyz="1.05 0.3 0.98" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.08 0.08 0.24"/>'...
'      </geometry>'...
'      <material name="material_74ea872e-4f41-11e5-8085-54ee75451821">'...
'        <color rgba="0.9 0.9 0.1 1"/>'...
'      </material>'...
'    </visual>'...
'    <collision>'...
'      <origin xyz="1.05 0.3 0.98" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.08 0.08 0.24"/>'...
'      </geometry>'...
'    </collision>'...
'  </link>'...
'  <link name="link_74e85bac-4f41-11e5-8085-54ee75451821">'...
'    <visual>'...
'      <origin xyz="1.2 0.5 0.4" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.5 0.05 0.8"/>'...
'      </geometry>'...
'      <material name="material_74e85bac-4f41-11e5-8085-54ee75451821">'...
'        <color rgba="0.66 0.66 0.66 1"/>'...
'      </material>'...
'    </visual>'...
'    <collision>'...
'      <origin xyz="1.2 0.5 0.4" rpy="0.0 0.0 0.0"/>'...
'      <geometry>'...
'        <box size="0.5 0.05 0.8"/>'...
'      </geometry>'...
'    </collision>'...
'  </link>'...
'</robot>'];
s = s.setEnvironment(environment_urdf_string);
r = s.robot_and_environment;

% position of object:
%xGoal = [1.05, 0.3, 0.98, 1.0, 0.0, 0.0, 0.0];
% full configuration: [7,38] where 7 element is position of point near to
% the hand - not the frame of the hand
%xGoal = [1.051, 0.300, 0.979, -0.652, 0.000, -0.000, 0.758, 0.442, -0.162, 1.023, -0.108, 0.062, -0.187, -0.239, 0.303, -0.230, 0.134, 0.042, -0.146, 0.196, 1.506, 0.054, 0.856, 1.574, -0.012, 0.027, -0.100, -0.593, -0.693, -1.430, 0.934, -0.071, -0.360, 0.236, 0.316, -0.820, 1.056, -0.320, -0.228, 0.236, 0.327, -0.796, 1.101, -0.390, -0.238];
% robot configuration: [38]
xGoal = [0.518, -0.087, 1.005, -0.033, 0.051, -0.092, -0.115, 0.153, -0.143, 0.000, -0.000, -0.000, 0.300, 1.250, 0.000, 0.785, 1.571, 0.000, 0.000, -0.195, -0.971, -0.316, -1.541, 1.167, -0.092, -0.061, 0.113, 0.150, -0.762, 1.271, -0.560, -0.123, 0.113, 0.151, -0.733, 1.265, -0.583, -0.125];

info = optimalCollisionFreePlanner(r, s, 'left', [0.62, 0.0, 1.0249999999999999, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.30019663134302466, 1.25, 0.0, 0.78539816339744828, 1.571, 0.0, 0.0, 0.30019663134302466, -1.25, 0.0, -0.78539816339744828, 1.571, 0.0, 0.0, 0.0, 0.0, -0.48999999999999999, 1.2050000000000001, -0.70999999999999996, 0.0, 0.0, 0.0, -0.48999999999999999, 1.2050000000000001, -0.70999999999999996, 0.0], xGoal, 0);

disp(info)
